<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolução do Paciente</title>
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
    <meta name="theme-color" content="#2c3e50" />

    <!-- JS – ordem de dependência preservada com defer -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Seu script, que depende das bibliotecas acima -->
    <script src="/static/js/clinica_medico.js?v=20250627" defer></script>
    <script src="/static/js/informacoes_alta.js" defer></script>
    <script src="/static/js/modal_hda_fix.js" defer></script>
    <script src="/static/js/modals_medico_fix.js" defer></script>
    <script src="/static/js/multi.js" defer></script>
    
    <!-- Script para interceptar e substituir scroll.js -->
    <script>
        // Interceptar scripts antes que sejam carregados
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
            const element = originalCreateElement.call(document, tagName);
            
            if (tagName.toLowerCase() === 'script') {
                const originalSetAttribute = element.setAttribute;
                element.setAttribute = function(name, value) {
                    if (name === 'src' && value && value.includes('scroll.js')) {
                        console.log('Interceptado carregamento de scroll.js - Substituindo com implementação moderna');
                        // Não carregamos o script original
                        return element;
                    }
                    return originalSetAttribute.call(this, name, value);
                };
            }
            
            return element;
        };
        
        // Nota: As funções de observadores foram movidas para clinica_medico.js
    </script>
    
    <style>
        body {
            background-color: #f8f9fa;
            display: flex;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .sidebar:hover + .main-content {
            margin-left: 200px;
        }
        
        /* Variáveis de cores */
        :root {
            --primary-dark: #1a237e;
            --primary-main: #283593;
            --primary-light: #3949ab;
            --accent: #1565c0;
            --hover-light: rgba(255,255,255,0.08);
            --text-primary: #ffffff;
            --text-secondary: rgba(255,255,255,0.85);
            --shadow-soft: 0 2px 4px rgba(0,0,0,0.08);
            --shadow-strong: 0 4px 8px rgba(0,0,0,0.12);
            --gradient-primary: linear-gradient(135deg, var(--primary-main), var(--primary-light));
            --gradient-accent: linear-gradient(135deg, var(--accent), var(--primary-light));
            --primary-main-rgb: 40, 53, 147;
            --primary-light-rgb: 57, 73, 171;
        }

        /* Estilos globais para cards e headers */
        .card {
            border: none;
            box-shadow: var(--shadow-soft);
            transition: box-shadow 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-strong);
        }

        .card-header {
            border-bottom: none;
            background: var(--gradient-primary) !important;
            color: var(--text-primary) !important;
        }

        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            box-shadow: var(--shadow-soft);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--gradient-accent);
            box-shadow: var(--shadow-strong);
            transform: translateY(-1px);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f57c00, #ffb74d);
            border: none;
            color: var(--text-primary);
            box-shadow: var(--shadow-soft);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #ff9800, #ffa726);
            color: var(--text-primary);
            box-shadow: var(--shadow-strong);
            transform: translateY(-1px);
        }

        .badge {
            background: var(--gradient-primary);
            border: none;
            box-shadow: var(--shadow-soft);
        }

        /* Estilos para prescrições */
        .prescricao-container {
            transition: all 0.3s ease;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 1px solid #e9ecef;
            background-color: #fff;
        }

        .prescricao-container:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-strong);
        }

        /* Novo estilo para prescrições do dia */
        .prescricao-hoje {
            border-left: 4px solid var(--primary-main);
            background-color: rgba(var(--primary-main-rgb), 0.02);
            position: relative;
        }

        .prescricao-hoje::before {
            
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--primary-main);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .prescricao-antiga {
            border-left: 4px solid transparent;
        }

        .prescricao-header {
            padding: 12px 15px;
            background: var(--gradient-primary);
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prescricao-body {
            padding: 15px;
        }

        /* Estilos para as ações rápidas */
        .quick-actions {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            background: linear-gradient(0deg, var(--primary-dark) 0%, transparent 100%);
        }

        .quick-actions .action-btn {
            background-color: transparent;
            border: none;
            color: var(--text-secondary);
            opacity: 0.9;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .quick-actions .action-btn:hover {
            opacity: 1;
            color: var(--text-primary);
            background-color: var(--hover-light);
            transform: translateX(5px);
            border-color: rgba(255,255,255,0.1);
        }

        .menu-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .nav-pills {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* Resto dos estilos existentes */
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .paciente-info {
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        .paciente-info .info-item {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        .paciente-info .info-item strong {
            color: #495057;
        }
        .table-medicamentos {
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
        }
        .alerta-alergia {
            border: 2px solid #ffc107;
            padding: 5px 10px;
            display: none;
            font-weight: bold;
            color: #856404;
            background-color: #fff3cd;
            border-radius: 4px;
            margin-top: 5px;
        }
        /* Estilos adicionais para a tabela de evoluções */
        .table-medicamentos td {
            vertical-align: middle;
            padding: 10px;
        }
        
        /* Estilos para as tabelas de medicamentos nas prescrições */
        .prescricao-card {
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 8px;
            overflow: hidden;
        }
        
        .prescricao-card .card-header {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        .prescricao-card .card-body {
            padding: 8px;
        }
        
        .tabela-medicamentos-prescricao th,
        .tabela-medicamentos-prescricao td {
            padding: 4px 8px;
            font-size: 0.85rem;
        }
        
        .tabela-medicamentos-prescricao tbody tr:hover {
            background-color: rgba(13, 110, 253, 0.05);
        }
        
        /* Novos estilos para melhorar a distinção entre prescrições */
        .prescricao-container {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative;
        }
        
        .prescricao-container:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .prescricao-header {
            background-color: #f1f8ff;
            padding: 5px 10px;
            margin: -12px -12px 10px -12px;
            border-bottom: 1px solid #dee2e6;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
        }
        
        .prescricao-header .medico-info {
            font-weight: bold;
            color: #0d6efd;
        }
        
        .prescricao-header .timestamp {
            color: #6c757d;
            font-size: 0.85rem;
        }
        
        .prescricao-section {
            margin-bottom: 10px;
            border-left: 3px solid #cfe2ff;
            padding-left: 10px;
        }
        
        .prescricao-section.dieta {
            border-color: #d1e7dd;
        }
        
        .prescricao-section.medicamentos {
            border-color: #cfe2ff;
        }
        
        .prescricao-section.procedimentos {
            border-color: #f8d7da;
        }
        
        .prescricao-section-title {
            font-weight: bold;
            color: #495057;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .prescricao-section-content {
            background-color: #f8f9fa;
            padding: 8px;
        }
        
        .prescricao-actions {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        .data-header {
            background-color: #6c757d;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }
        
        /* Formatação especial para a coluna de texto de evolução */
        .texto-evolucao {
            white-space: pre-wrap;
            word-break: break-word;
            overflow-wrap: break-word;
            min-height: 150px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 6px;
            border-left: 4px solid #0d6efd;
            font-size: 0.9rem;
            line-height: 1.5;
            transition: all 0.3s ease;
        }
        
        .texto-evolucao p {
            margin-bottom: 0.6rem;
        }
        
        .texto-evolucao * {
            max-width: 100%;
        }
        
        .texto-evolucao h1, .texto-evolucao h2, .texto-evolucao h3 {
            margin-top: 0.8rem;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }
        
        .texto-evolucao ul, .texto-evolucao ol {
            padding-left: 25px;
            margin-bottom: 0.8rem;
        }
        
        .texto-evolucao li {
            margin-bottom: 0.3rem;
        }
        
        .texto-evolucao strong, .texto-evolucao b {
            font-weight: 700;
        }
        
        .texto-evolucao em, .texto-evolucao i {
            font-style: italic;
        }
        
        .texto-evolucao blockquote {
            margin: 0.8rem 0;
            padding: 0.5rem 1rem;
            border-left: 3px solid #adb5bd;
            background-color: #f0f0f0;
        }
        
        .texto-evolucao::-webkit-scrollbar {
            width: 10px;
        }
        
        .texto-evolucao::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .texto-evolucao::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .texto-evolucao::-webkit-scrollbar-thumb:hover {
            background: #0d6efd;
        }
        
        #editor-container {
            height: 450px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
        }
        
        .ql-editor {
            overflow-y: auto !important;
            max-height: 100% !important;
            scroll-behavior: smooth;
            font-size: 13px;
            line-height: 1.5;
            min-height: 400px;
        }
        
        .ql-tooltip {
            z-index: 1060 !important;
        }
        
        @media (max-width: 768px) {
            .texto-evolucao {
                font-size: 0.85rem;
                min-height: 100px;
            }
            #editor-container {
                height: 250px;
            }
            .ql-editor {
                min-height: 200px;
            }
        }
        
        /* Estilos para adaptar a altura da caixa baseado no tamanho do conteúdo */
        .texto-evolucao[data-lines="1"],
        .texto-evolucao[data-lines="2"],
        .texto-evolucao[data-lines="3"] {
            max-height: 150px;
            min-height: 80px;
        }
        
        .texto-evolucao[data-lines="4"],
        .texto-evolucao[data-lines="5"],
        .texto-evolucao[data-lines="6"] {
            max-height: 200px;
            min-height: 100px;
        }
        
        .texto-evolucao[data-lines="7"],
        .texto-evolucao[data-lines="8"],
        .texto-evolucao[data-lines="9"] {
            max-height: 250px;
            min-height: 150px;
        }
        
        .texto-evolucao[data-lines="10"],
        .texto-evolucao[data-lines="11"],
        .texto-evolucao[data-lines="12"] {
            max-height: 300px;
            min-height: 200px;
        }
        
        .texto-evolucao[data-lines="13"],
        .texto-evolucao[data-lines="14"],
        .texto-evolucao[data-lines="15"] {
            max-height: 350px;
            min-height: 250px;
        }
        
        .texto-evolucao[data-lines="16"],
        .texto-evolucao[data-lines="17"],
        .texto-evolucao[data-lines="18"] {
            max-height: 400px;
            min-height: 300px;
        }
        
        .texto-evolucao[data-lines="19"],
        .texto-evolucao[data-lines="20"],
        .texto-evolucao[data-lines="21"] {
            max-height: 450px;
            min-height: 350px;
        }
        
        .texto-evolucao[data-lines="22"] {
            max-height: 500px;
            min-height: 400px;
        }
        
        /* Sobrescrever regras data-lines para permitir expansão automática */
        .texto-evolucao[data-lines] {
            max-height: none !important;
            height: auto !important;
        }
        
        /* Estilos para o calendário de aprazamento */
        .calendar-day {
            width: 120px;
            min-height: 80px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            background-color: #f8f9fa;
        }
        
        .calendar-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            background-color: #fff;
        }
        
        .day-header {
            font-weight: bold;
            border-bottom: 1px dashed #dee2e6;
            padding-bottom: 5px;
        }
        
        .time-pill {
            border: 1px solid #e9ecef;
            transition: all 0.2s;
        }
        
        .time-pill:hover {
            background-color: #e9ecef;
        }
        
        /* Estilos para popovers dos dias */
        .popover {
            max-width: 300px;
        }
        
        .popover-body {
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* Novos estilos para o modal de aprazamento redesenhado */
        #modalAprazamento .modal-content {
            border: none;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        #modalAprazamento .modal-header {
            background: linear-gradient(135deg, #4a6fdc 0%, #2856d4 100%);
            border-bottom: none;
            padding: 20px 24px;
        }
        
        #modalAprazamento .modal-title {
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        #modalAprazamento .modal-body {
            padding: 24px;
        }
        
        #modalAprazamento .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 8px;
        }
        
        #modalAprazamento .input-group-text {
            background-color: #f8f9fa;
            border-color: #ced4da;
            color: #6c757d;
        }
        
        #modalAprazamento .form-control,
        #modalAprazamento .form-select {
            border-color: #ced4da;
            padding: 10px 15px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        #modalAprazamento .form-control:focus,
        #modalAprazamento .form-select:focus {
            border-color: #4a6fdc;
            box-shadow: 0 0 0 0.25rem rgba(74, 111, 220, 0.25);
        }
        
        #modalAprazamento .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        #modalAprazamento .card:hover {
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }
        
        #modalAprazamento .alert {
            border-radius: 8px;
            border: none;
        }
        
        #modalAprazamento .alert-info {
            background-color: #e6f3fd;
            color: #0c63e4;
        }
        
        #modalAprazamento .btn-primary {
            background: linear-gradient(to right, #4a6fdc, #2856d4);
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        #modalAprazamento .btn-primary:hover {
            background: linear-gradient(to right, #5d7fe3, #3967e5);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(45, 85, 211, 0.3);
        }
        
        #modalAprazamento .btn-outline-secondary {
            border-color: #ced4da;
            color: #495057;
        }
        
        #modalAprazamento .btn-success {
            background: linear-gradient(to right, #28a745, #218838);
            border: none;
            font-weight: 500;
        }
        
        #modalAprazamento .btn-success:hover {
            background: linear-gradient(to right, #2fd050, #27a844);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }
        
        #horarios_multiplos_dias .form-check-input {
            width: 18px;
            height: 18px;
            margin-top: 3px;
        }
        
        #horarios_multiplos_dias .form-check-input:checked {
            background-color: #4a6fdc;
            border-color: #4a6fdc;
        }
        
        #horarios_multiplos_dias .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            font-weight: 600;
            padding: 12px 15px;
        }
        
        #horarios_multiplos_dias .btn-group .btn {
            padding: 5px 10px;
            font-size: 0.85rem;
        }

        /* Estilos para o modal de visualização de aprazamentos */
        .modal-visualizar-aprazamento .modal-content {
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .modal-visualizar-aprazamento .modal-header {
            background-color: #17a2b8;
            color: white;
            border-radius: 8px 8px 0 0;
        }

        .modal-visualizar-aprazamento .table {
            margin-bottom: 0;
        }

        .modal-visualizar-aprazamento .table th {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .modal-visualizar-aprazamento .table td {
            vertical-align: middle;
            font-size: 0.9rem;
        }

        .modal-visualizar-aprazamento .resumo-aprazamentos {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 1rem;
        }

        .modal-visualizar-aprazamento .resumo-aprazamentos .col {
            text-align: center;
        }

        .modal-visualizar-aprazamento .resumo-aprazamentos small {
            display: block;
            margin-bottom: 0.25rem;
            color: #6c757d;
        }

        .modal-visualizar-aprazamento .resumo-aprazamentos strong {
            font-size: 1.25rem;
            display: block;
        }

        .modal-visualizar-aprazamento .status-icon {
            margin-right: 0.5rem;
        }

        .modal-visualizar-aprazamento .table-responsive {
            max-height: 400px;
            overflow-y: auto;
        }

        /* Estilos para os botões de RN */
        .rn-buttons {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .rn-buttons .btn {
            margin-right: 10px;
        }

        /* Estilos para o modal de RN */
        .modal-rn .form-group {
            margin-bottom: 15px;
        }

        /* Efeito visual após atualização */
        @keyframes flashUpdate {
            0% { background-color: #d4edda; }
            100% { background-color: transparent; }
        }
        .flash-update {
            animation: flashUpdate 1.5s ease-out;
        }

        /* Submenu lateral */
        .submenu .nav-link {
            padding-left: 40px;
            font-size: 0.85rem;
        }

        .submenu .nav-link i {
            font-size: 0.9rem;
        }

        .submenu {
            display: none; /* escondida por padrão */
            flex-direction: column;
        }

        /* Mostrar submenu quando o item principal estiver em hover ou o próprio submenu em hover */
        .nav-pills .nav-link:hover + .submenu,
        .submenu:hover {
            display: flex;
        }

        .nav-pills .nav-link.has-submenu {
            margin-bottom: 0; /* remove gap abaixo do item principal */
        }

        .submenu {
            margin: 0 10px 5px 10px; /* mesmo recuo lateral e espaçamento inferior */
        }

        /* Mostrar submenu ao passar o mouse */
        .nav-pills .nav-link.has-submenu:hover + .submenu,
        .submenu:hover {
            display: flex;
        }

        /* Seções de Enfermagem */
        .enf-section {display: none;}
        .enf-section.active {display: block;}

        /* Seções Multiprofissionais */
        .mp-section {display: none;}
        .mp-section.active {display: block;}

        /* Link ativo no submenu */
        .submenu .nav-link.active {
            background-color: var(--accent);
            color: var(--text-primary);
        }

        /* Estilos para o botão de impressão discreto */
        .timestamp-with-print {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-print-discreto {
            background: none;
            border: none;
            color: #26db0e;
            padding: 4px 6px;
            border-radius: 4px;
            font-size: 0.85rem;
            opacity: 0.7;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .btn-print-discreto:hover {
            background-color: rgba(13, 110, 253, 0.1);
            color: #0d6efd;
            opacity: 1;
            transform: scale(1.1);
        }

        .btn-print-discreto:active {
            transform: scale(0.95);
        }

        .btn-print-discreto i {
            font-size: 0.9rem;
        }

        /* Estilos para botões de ação das prescrições */
        .prescricao-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .btn-action-discreto {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-action-discreto:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .btn-verde {
            background-color: #28a745 !important;
            color: white !important;
            border-color: #28a745 !important;
        }

        .btn-verde:hover {
            background-color: #218838 !important;
            border-color: #1e7e34 !important;
        }

        .btn-print-discreto {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-print-discreto:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        /* Variáveis RGB para transparência */
        :root {
            --primary-main-rgb: 40, 53, 147;
            --primary-light-rgb: 57, 73, 171;
        }

        /* Estilos específicos para informações do médico e timestamp */
        .medico-info {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .medico-nome {
            font-weight: 600;
            color: var(--text-primary);
        }

        .timestamp {
            color: rgba(255, 255, 255, 0.85);
            font-size: 0.9rem;
            font-weight: 400;
            margin-left: 4px;
        }

        /* Estilo do menu lateral */
        .sidebar {
            width: 60px;
            height: 100vh;
            background: linear-gradient(180deg, var(--primary-dark) 0%, var(--primary-main) 100%);
            position: fixed;
            left: 0;
            top: 0;
            padding-top: 20px;
            transition: all 0.3s ease;
            overflow: hidden;
            z-index: 1000;
            box-shadow: var(--shadow-soft);
        }
        
        .sidebar:hover {
            width: 200px;
            box-shadow: var(--shadow-strong);
        }
        
        .nav-pills {
            flex-direction: column;
            padding: 0;
            margin: 0;
        }
        
        .nav-pills .nav-link {
            margin: 5px 10px;
            border-radius: 8px;
            padding: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .nav-pills .nav-link:hover {
            background-color: var(--hover-light);
            transform: translateX(5px);
            color: var(--text-primary);
            border-color: rgba(255,255,255,0.1);
        }
        
        .nav-pills .nav-link i {
            font-size: 1.2rem;
            min-width: 30px;
            text-align: center;
            transition: transform 0.3s ease;
            color: var(--text-primary);
        }
        
        .nav-pills .nav-link:hover i {
            transform: scale(1.1);
        }
        
        .nav-pills .nav-link span {
            margin-left: 10px;
            opacity: 0;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .sidebar:hover .nav-pills .nav-link span {
            opacity: 1;
            transform: translateX(0);
        }
        
        .nav-pills .nav-link.active {
            background-color: var(--accent);
            color: var(--text-primary);
            box-shadow: 0 2px 4px rgba(21,101,192,0.3);
            border-color: rgba(255,255,255,0.2);
        }
        
        .nav-pills .nav-link.active:hover {
            transform: translateX(5px) scale(1.02);
            background-color: var(--accent);
        }
        
        /* Ajuste do conteúdo principal */
        .main-content {
            margin-left: 60px;
            flex: 1;
            padding: 20px;
            transition: all 0.3s ease;
        }

        /* Estilos específicos para as abas de evolução */
        #evolucaoTabs .nav-link {
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        #evolucaoTabs .nav-link:hover {
            background-color: rgba(13, 110, 253, 0.1);
            border-color: rgba(13, 110, 253, 0.2);
        }

        #evolucaoTabs .nav-link.active {
            background-color: var(--primary-main);
            border-color: var(--primary-main);
            color: white;
        }

        #evolucaoTabContent {
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 8px 8px;
        }

        /* Estilos para cards aninhados nas abas */
        #evolucaoTabContent .card {
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        #evolucaoTabContent .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* Espaçamento adicional para visualizações */
        #evolucaoTabContent .card-body {
            padding: 1.5rem;
        }

        #evolucaoTabContent .p-4 {
            padding: 2rem !important;
        }

        /* Melhor espaçamento para cards com altura fixa */
        .card.h-100 {
            height: auto !important;
            min-height: 300px;
        }

        /* Espaçamento entre linhas de cards */
        .row.g-4 {
            margin-bottom: 2rem;
        }

        /* ===== ESTILOS PARA CAMPOS READONLY/DISABLED ===== */
        
        /* Estilos para campos readonly */
        .form-control:read-only,
        .form-select:disabled {
            background-color: #f8f9fa;
            border-color: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        /* Destaque sutil para indicar que é automático */
        .form-control:read-only {
            background-image: linear-gradient(45deg, transparent 25%, rgba(255,255,255,.2) 25%, rgba(255,255,255,.2) 50%, transparent 50%, transparent 75%, rgba(255,255,255,.2) 75%, rgba(255,255,255,.2));
            background-size: 8px 8px;
        }
        
        /* Labels com indicação de automático */
        .form-label small.text-muted {
            font-weight: normal;
            font-style: italic;
        }

        /* Indicadores de status para os cards */
        .card-header.bg-primary {
            background: linear-gradient(135deg, var(--primary-main), var(--primary-light)) !important;
        }

        .card-header.bg-info {
            background: linear-gradient(135deg, #17a2b8, #20c997) !important;
        }

        .card-header.bg-warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14) !important;
        }

        .card-header.bg-success {
            background: linear-gradient(135deg, #28a745, #20c997) !important;
        }

        .card-header.bg-secondary {
            background: linear-gradient(135deg, #6c757d, #495057) !important;
        }

        /* Estilos para loading states */
        .tab-pane .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        /* Responsive para as abas */
        @media (max-width: 768px) {
            #evolucaoTabs .nav-link {
                font-size: 0.9rem;
                padding: 8px 12px;
            }
            
            #evolucaoTabs .nav-link i {
                display: none;
            }
            
            #evolucaoTabContent {
                padding: 15px !important;
            }
        }
        
        /* Estilos personalizados para a interface de diagnóstico */
        #diagnostico-edicao .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
        
        #diagnostico-edicao .card {
            transition: all 0.3s ease;
        }
        
        #diagnostico-edicao .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-loading .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
        
        #diagnostico-visualizacao .card-header button {
            transition: all 0.2s ease;
        }
        
        #diagnostico-visualizacao .card-header button:hover {
            transform: scale(1.05);
        }
        
        .alert {
            border-left: 4px solid;
        }
        
        .alert-success {
            border-left-color: #198754;
        }
        
        .alert-danger {
            border-left-color: #dc3545;
        }
        
        .alert-info {
            border-left-color: #0dcaf0;
        }
        
        /* Animação suave para transições */
        #diagnostico-visualizacao, #diagnostico-edicao {
            transition: opacity 0.3s ease;
        }
        
        /* Melhorar aparência dos campos de texto */
        #diagnostico-edicao textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        #diagnostico-edicao input[type="text"] {
            text-transform: uppercase;
        }
        
        /* Loading spinner personalizado */
        .spinner-border-primary {
            color: #0d6efd;
        }

        /* ===== ESTILOS PARA FICHAS DE REFERÊNCIA ===== */
        
        /* Estatísticas das fichas */
        .fichas-stats {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid #dee2e6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            text-align: center;
        }

        .stat-item {
            padding: 0.5rem;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6c757d;
            font-weight: 500;
        }

        /* Grid das fichas */
        .fichas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        /* Card da ficha */
        .ficha-card {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.06);
        }

        .ficha-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            border-color: #007bff;
        }

        /* Header da ficha */
        .ficha-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 16px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #dee2e6;
        }

        .ficha-info {
            flex: 1;
        }
        
        .ficha-titulo {
            font-weight: 600;
            font-size: 1rem;
            color: #2c3e50;
            margin-bottom: 6px;
        }
        
        .ficha-metadados {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .ficha-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-action {
            background: #fff;
            border: 1px solid #dee2e6;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #6c757d;
        }
        
        .btn-action:hover {
            background: #007bff;
            border-color: #007bff;
            color: white;
            transform: scale(1.05);
        }
        
        .btn-print:hover {
            background: #28a745;
            border-color: #28a745;
        }
        
        .ficha-content {
            padding: 16px;
        }
        
        .campo-principal {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid #007bff;
        }
        
        .campo-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        
        .campo-valor {
            color: #2c3e50;
            line-height: 1.4;
        }
        
        .destaque-unidade {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 600;
            color: #1565c0;
            border: 1px solid #90caf9;
        }
        
        .campo-secundario {
            border-left: 3px solid #ffc107;
            padding-left: 12px;
        }
        
        .campo-label-pequeno {
            font-size: 0.85rem;
            font-weight: 500;
            color: #6c757d;
            margin-bottom: 4px;
        }
        
        .campo-valor-pequeno {
            font-size: 0.9rem;
            color: #495057;
            line-height: 1.3;
        }
        
        .tem-mais-conteudo {
            margin-top: 12px;
            padding: 8px 12px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        /* Estilos removidos: ficha-footer, btn-expand, expand-icon, ficha-expanded */
        /* Agora usamos apenas o modal de visualização */
        
        /* Estilos para o Modal de Visualização */
        .ficha-visualizacao {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .stats-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            padding: 15px;
            color: white;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .stat-icon {
            font-size: 2rem;
            opacity: 0.8;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .empty-state {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .fichas-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .ficha-header {
                padding: 12px;
            }
            
            .ficha-content {
                padding: 12px;
            }
            
            .ficha-metadados {
                font-size: 0.8rem;
            }
        }
        
        /* Estilos para o Modal de Visualização */
        .ficha-visualizacao {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .ficha-header-modal {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #dee2e6;
        }
        
        .ficha-header-modal h5 {
            color: #2c3e50;
            font-weight: 600;
            margin: 0;
        }
        
        .campo-modal {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .campo-titulo-modal {
            font-weight: 600;
            color: #495057;
            margin-bottom: 12px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            border-bottom: 2px solid #f1f3f4;
            padding-bottom: 8px;
        }
        
        .campo-conteudo-modal {
            color: #2c3e50;
            line-height: 1.6;
            font-size: 0.95rem;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        
        .destaque-unidade-modal {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left-color: #2196f3;
            font-weight: 600;
            color: #1565c0;
        }
        
        .texto-referencia-modal {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left-color: #ff9800;
            color: #e65100;
        }
        
        /* === ESTILOS PARA A NOVA MODAL DE FICHA DE REFERÊNCIA === */
        
        /* Modal de tamanho extra-large com visual aprimorado */
        .modal-xl {
            --bs-modal-width: 1200px;
        }
        
        /* Header com gradiente */
        .bg-gradient-primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        
        /* Conteúdo da modal com padding aprimorado */
        .modal-body.p-4 {
            padding: 2rem !important;
            background: #f8f9fa;
        }
        
        /* Alerta informativo estilizado */
        .alert-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            border: 1px solid #b6d4da;
            color: #0c5460;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 2px 8px rgba(23, 162, 184, 0.15);
        }
        
        /* Form floating labels melhorados */
        .form-floating > .form-control {
            height: calc(3.5rem + 2px);
            line-height: 1.25;
            font-size: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .form-floating > .form-control:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            background-color: #fff;
        }
        
        .form-floating > label {
            padding: 1rem 0.75rem;
            color: #6c757d;
            font-weight: 500;
        }
        
        /* Checkboxes aprimorados */
        .form-check-lg {
            background: #ffffff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .form-check-lg:hover {
            border-color: #007bff;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .form-check-lg .form-check-input {
            margin-top: 0.1rem;
            transform: scale(1.3);
        }
        
        .form-check-lg .form-check-input:checked {
            background-color: #007bff;
            border-color: #007bff;
        }
        
        .form-check-lg .form-check-label {
            cursor: pointer;
            font-size: 1rem;
            padding-left: 0.5rem;
        }
        
        .form-check-lg .form-check-label small {
            color: #6c757d;
            font-size: 0.875rem;
        }
        
        /* Área do texto de referência destacada */
        .border-primary.border-2 {
            border-color: #007bff !important;
            border-width: 2px !important;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 15px !important;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.1);
        }
        
        /* Textarea principal */
        #texto_referencia {
            border: none !important;
            background: transparent !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-size: 14px !important;
            line-height: 1.6 !important;
            resize: vertical !important;
            box-shadow: none !important;
        }
        
        #texto_referencia:focus {
            outline: none !important;
            box-shadow: none !important;
        }
        
        #texto_referencia::placeholder {
            color: #6c757d;
            font-style: italic;
            opacity: 0.8;
        }
        
        /* Footer da modal */
        .modal-footer.bg-light {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
            border-top: 2px solid #dee2e6;
        }
        
        /* Botões aprimorados */
        .btn-lg {
            padding: 0.75rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .btn-success.btn-lg {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            border: none;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn-success.btn-lg:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .btn-outline-secondary.btn-lg {
            border: 2px solid #6c757d;
            color: #6c757d;
        }
        
        .btn-outline-secondary.btn-lg:hover {
            background: #6c757d;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        
        /* Ícones coloridos */
        .text-primary { color: #007bff !important; }
        .text-info { color: #17a2b8 !important; }
        .text-success { color: #28a745 !important; }
        .text-warning { color: #ffc107 !important; }
        .text-danger { color: #dc3545 !important; }
        
        /* Animações suaves */
        .modal.fade .modal-dialog {
            transition: transform 0.4s ease-out;
        }
        
        .modal.show .modal-dialog {
            transform: none;
        }
        
        /* Responsividade */
        @media (max-width: 1200px) {
            .modal-xl {
                --bs-modal-width: 95vw;
            }
        }
        
        @media (max-width: 768px) {
            .modal-body.p-4 {
                padding: 1rem !important;
            }
            
            .form-check-lg {
                padding: 0.75rem;
            }
            
            #texto_referencia {
                min-height: 200px !important;
            }
            
            .btn-lg {
                padding: 0.6rem 1.5rem;
                font-size: 1rem;
            }
        }
        
        /* Responsividade do Modal */
        @media (max-width: 768px) {
            .ficha-header-modal {
                padding: 15px;
            }
            
            .campo-modal {
                padding: 12px;
            }
            
            .campo-titulo-modal {
                font-size: 0.9rem;
            }
            
            .campo-conteudo-modal {
                font-size: 0.9rem;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
<!-- Menu Lateral -->
<div class="sidebar">
    <nav class="nav nav-pills flex-column">
        <!-- Menu Principal -->
        <div class="menu-section">
            <a class="nav-link active" href="#prescricaoSection" data-bs-toggle="pill">
                <i class="fas fa-pills"></i>
                <span>Prescrição</span>
            </a>
            <a class="nav-link" href="#evolucaoSection" data-bs-toggle="pill">
                <i class="fas fa-notes-medical"></i>
                <span>Evolução</span>
            </a>
            <a class="nav-link has-submenu" href="#enfermagemSection" data-bs-toggle="pill">
                <i class="fas fa-user-nurse"></i>
                <span>Enfermagem</span>
            </a>
            <!-- Submenu para Enfermagem -->
            <div class="submenu">
                <a class="nav-link submenu-link active" href="#" data-enf-target="enfAdmissaoSection">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Admissão</span>
                </a>
                <a class="nav-link submenu-link" href="#" data-enf-target="enfEvolucoesSection">
                    <i class="fas fa-notes-medical"></i>
                    <span>Evoluções</span>
                </a>
                <a class="nav-link submenu-link" href="#" data-enf-target="enfSAESection">
                    <i class="fas fa-stethoscope"></i>
                    <span>SAE</span>
                </a>
            </div>
            <a class="nav-link" href="#prescricaoEnfermagemSection" data-bs-toggle="pill">
                <i class="fas fa-clipboard-list"></i>
                <span>Prescrição Enf.</span>
            </a>
            <a class="nav-link" href="#examesSection" data-bs-toggle="pill">
                <i class="fas fa-vial"></i>
                <span>Exames</span>
            </a>
            <a class="nav-link" href="#receituarioSection" data-bs-toggle="pill">
                <i class="fas fa-prescription"></i>
                <span>Receituário</span>
            </a>
            <a class="nav-link" href="#fichaReferenciaSection" data-bs-toggle="pill">
                <i class="fas fa-file-export"></i>
                <span>Ficha de Referência</span>
            </a>
            <a class="nav-link has-submenu" href="#areaMultiprofissionalSection" data-bs-toggle="pill">
                <i class="fas fa-users"></i>
                <span>Área Multiprofissional</span>
            </a>
            <!-- Submenu para Área Multiprofissional -->
            <div class="submenu">
                <a class="nav-link submenu-link active" href="#" data-mp-target="fisioterapiaSection">
                    <i class="fas fa-running"></i>
                    <span>Fisioterapia</span>
                </a>
                <a class="nav-link submenu-link" href="#" data-mp-target="nutricaoSection">
                    <i class="fas fa-apple-alt"></i>
                    <span>Nutrição</span>
                </a>
                <a class="nav-link submenu-link" href="#" data-mp-target="assistenciaSocialSection">
                    <i class="fas fa-hands-helping"></i>
                    <span>Assistência Social</span>
                </a>
            </div>
            <a class="nav-link" href="#atestadoSection" data-bs-toggle="pill">
                <i class="fas fa-file-medical"></i>
                <span>Atestados</span>
            </a>
            <a class="nav-link" href="#internamentoInfoSection" data-bs-toggle="pill">
                <i class="fas fa-notes-medical"></i>
                <span>Informações Internamento</span>
            </a>
        </div>
    </nav>
</div>

<!-- Conteúdo Principal -->
<div class="main-content">
    <div class="container-fluid py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Evolução do Paciente</h2>
            <div>
                <button type="button" class="btn btn-outline-info me-2" id="btnHistoricoInternamentos">
                    <i class="fas fa-history"></i> Histórico de Internamentos
                </button>
                {% if internacao.data_alta %}
                <button type="button" class="btn btn-success me-2" onclick="verInformacoesAlta('{{ internacao.atendimento_id }}')">
                    <i class="fas fa-user-check me-1"></i> Informações de Alta
                </button>
                {% endif %}
                <a href="/clinica/pacientes-internados" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left"></i> Voltar
                </a>
            </div>
        </div>

    <!-- Informações do Paciente -->
    <div class="paciente-info row">
        <div class="col-md-3 info-item"><strong>Nome:</strong> {{ paciente.nome }}</div>
        <div class="col-md-3 info-item"><strong>CPF:</strong> {{ paciente.cpf }}</div>
        <div class="col-md-3 info-item"><strong>Cartão SUS:</strong> {{ paciente.cartao_sus }}</div>
        <div class="col-md-3 info-item"><strong>Sexo:</strong> {{ paciente.sexo }}</div>
        <div class="col-md-3 info-item"><strong>Data de Nascimento:</strong> {{ paciente.data_nascimento.strftime('%d/%m/%Y') if paciente.data_nascimento else '-' }}</div>
        <div class="col-md-3 info-item"><strong>Endereço:</strong> {{ paciente.endereco }}</div>
        <div class="col-md-3 info-item"><strong>Município:</strong> {{ paciente.municipio }}</div>
        <div class="col-md-3 info-item"><strong>Telefone:</strong> {{ paciente.telefone }}</div>
        <div class="col-md-3 info-item"><strong>Nome Social:</strong> {{ paciente.nome_social }}</div>
        <div class="col-md-3 info-item"><strong>Filiação:</strong> {{ paciente.filiacao }}</div>
    </div>

    <!-- Botões de RN/Mãe -->
    <div class="rn-buttons">
        <!-- Botões para quando o paciente é a mãe -->
        <div id="botoesResponsavel" style="display: none;">
            <button type="button" class="btn btn-primary" id="btnAssociarRN" onclick="abrirModalRN()">
                <i class="fas fa-baby"></i> Associar RN
            </button>
            <button type="button" class="btn btn-info" id="btnVerRN" style="display: none;" onclick="verFichaRN()">
                <i class="fas fa-file-medical"></i> Ver ficha do RN
            </button>
        </div>
        
        <!-- Botão para quando o paciente é RN -->
        <div id="botoesRN" style="display: none;">
            <button type="button" class="btn btn-info" id="btnVerMae" onclick="verFichaMae()">
                <i class="fas fa-female"></i> Ver ficha da mãe
            </button>
        </div>
    </div>



    <!-- Seção de Prescrições Médicas -->
    <div id="prescricaoSection" class="content-section">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Prescrições Médicas</h5>
            </div>
            <div class="card-body">
                <div class="prescricoes-lista">
                    <!-- Todas as prescrições serão listadas aqui -->
                    <div id="listaPrescricoes">
                        <!-- Preenchido via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Seção de Prescrições de Enfermagem -->
    <div id="prescricaoEnfermagemSection" class="content-section">
        <div class="card shadow-sm">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Prescrições de Enfermagem</h5>
            </div>
            <div class="card-body">
                <!-- Prescrições de Enfermagem de Hoje -->
                <div class="mb-3" id="hoje-container-prescricao-enfermagem">
                    <h6 class="fw-bold text-success mb-2">
                        <i class="fas fa-calendar-day me-1"></i> 
                        <span id="titulo-prescricoes-enfermagem-hoje">Prescrições de Enfermagem de Hoje</span>
                    </h6>
                    <div id="listaPrescricoesEnfermagemDoDia">
                        <!-- Preenchido via JavaScript -->
                    </div>
                </div>
                
                <!-- Prescrições de Enfermagem Anteriores -->
                <div class="mb-3" id="antigas-container-prescricao-enfermagem">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="fw-bold text-secondary mb-0">
                            <i class="fas fa-history me-1"></i> Prescrições de Enfermagem Anteriores
                        </h6>
                        <span class="badge bg-info" id="contador-prescricoes-enfermagem-antigas">0</span>
                    </div>
                    <div id="listaPrescricoesEnfermagemAntigas">
                        <!-- Preenchido via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="evolucaoSection" class="content-section">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-notes-medical me-2"></i>Evolução e Acompanhamento Médico</h5>
            </div>
            <div class="card-body p-0">
                <!-- Navegação por abas dentro da seção de Evolução -->
                <ul class="nav nav-tabs" id="evolucaoTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="evolucoes-tab" data-bs-toggle="tab" data-bs-target="#evolucoes-pane" type="button" role="tab">
                            <i class="fas fa-notes-medical me-2"></i>Evoluções
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="anamnese-tab" data-bs-toggle="tab" data-bs-target="#anamnese-pane" type="button" role="tab">
                            <i class="fas fa-user-md me-2"></i>Anamnese & Conduta
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="diagnostico-tab" data-bs-toggle="tab" data-bs-target="#diagnostico-pane" type="button" role="tab">
                            <i class="fas fa-stethoscope me-2"></i>Diagnóstico
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="justificativas-tab" data-bs-toggle="tab" data-bs-target="#justificativas-pane" type="button" role="tab">
                            <i class="fas fa-clipboard-list me-2"></i>Justificativas
                        </button>
                    </li>
                </ul>

                <div class="tab-content p-4" id="evolucaoTabContent">
                    <!-- Aba de Evoluções -->
                    <div class="tab-pane fade show active" id="evolucoes-pane" role="tabpanel">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h6 class="mb-0 text-primary fw-bold">Registro de Evoluções</h6>
                        </div>

                        <!-- HDA Section -->
                        <div class="card mb-4 border-info">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="fas fa-history me-2"></i>História da Doença Atual (HDA)</h6>
                            </div>
                            <div class="card-body">
                                <div id="hdaContainer" class="texto-evolucao bg-light p-3 rounded" style="min-height: 100px; white-space: pre-wrap;">{{ internacao.hda or 'HDA não registrada.' }}</div>
                                <textarea class="form-control d-none" id="hdaTexto">{{ internacao.hda or '' }}</textarea>
                            </div>
                        </div>
                        
                        <!-- Lista de Evoluções -->
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0 text-secondary"><i class="fas fa-list me-2"></i>Histórico de Evoluções</h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-primary">
                                            <tr>
                                                <th scope="col" style="width: 12%">Data/Hora</th>
                                                <th scope="col" style="width: 13%">Médico</th>
                                                <th scope="col" style="width: 65%">Evolução</th>
                                                <th scope="col" style="width: 10%">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="listaEvolucoes">
                                            <tr>
                                                <td colspan="4" class="text-center py-4">
                                                    <div class="spinner-border text-primary" role="status">
                                                        <span class="visually-hidden">Carregando...</span>
                                                    </div>
                                                    <p class="mt-2 text-muted">Carregando evoluções...</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba de Anamnese e Conduta -->
                    <div class="tab-pane fade" id="anamnese-pane" role="tabpanel">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h6 class="mb-0 text-success fw-bold">Anamnese e Conduta Médica</h6>
                        </div>

                        <div id="anamnese-conduta-loading" class="text-center my-4" style="display:none;">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Carregando...</span>
                            </div>
                        </div>
                        
                        <div id="anamnese-conduta-visualizacao">
                            <!-- Anamnese e Exame Físico -->
                            <div class="row g-4 mb-4">
                                <div class="col-12">
                                    <div class="card border-primary">
                                        <div class="card-header bg-primary text-white">
                                            <h6 class="mb-0"><i class="fas fa-user-check me-2"></i>Anamnese e Exame Físico</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="p-4 bg-light rounded texto-evolucao" id="anamnese-exame-fisico-display" style="min-height: 200px;">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-file-medical fa-3x mb-3"></i>
                                                    <p>Carregando informações da anamnese...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Conduta Médica -->
                            <div class="row g-4 mb-4">
                                <div class="col-12">
                                    <div class="card border-warning">
                                        <div class="card-header bg-warning text-dark">
                                            <h6 class="mb-0"><i class="fas fa-prescription me-2"></i>Conduta Médica</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="p-4 bg-light rounded texto-evolucao" id="conduta-medica-display" style="min-height: 200px;">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-clipboard-list fa-3x mb-3"></i>
                                                    <p>Carregando conduta médica...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Formulário de Edição (oculto inicialmente) -->
                        <div id="anamnese-conduta-edicao" style="display:none;">
                            <!-- FORMULÁRIO EMBUTIDO REMOVIDO: edição só via modal -->
                        </div>
                    </div>

                    <!-- Aba de Diagnóstico -->
                    <div class="tab-pane fade" id="diagnostico-pane" role="tabpanel">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h6 class="mb-0 text-info fw-bold">Diagnóstico e Classificação</h6>
                        </div>

                        <div id="diagnostico-loading" class="text-center my-4" style="display:none;">
                            <div class="spinner-border text-info" role="status">
                                <span class="visually-hidden">Carregando...</span>
                            </div>
                            <p class="mt-2 text-muted">Carregando dados do diagnóstico...</p>
                        </div>
                        
                        <!-- Visualização (padrão) -->
                        <div id="diagnostico-visualizacao">
                            <!-- Diagnóstico Principal -->
                            <div class="row g-4 mb-4">
                                <div class="col-md-12">
                                    <div class="card border-primary">
                                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                            <h6 class="mb-0"><i class="fas fa-diagnoses me-2"></i>Diagnóstico Principal</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-bold text-muted">Diagnóstico Inicial:</label>
                                                    <div class="p-4 bg-light rounded border" id="diagnostico-inicial-display" style="min-height: 150px;">
                                                        <div class="text-center text-muted">
                                                            <i class="fas fa-stethoscope fa-2x mb-3"></i>
                                                            <p class="mb-0">Carregando diagnóstico...</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-bold text-muted">CID Principal:</label>
                                                    <div class="p-3 bg-light rounded border" id="cid-principal-display" style="min-height: 80px;">
                                                        <div class="text-center text-muted">
                                                            <i class="fas fa-code fa-lg mb-2"></i>
                                                            <p class="mb-0">Carregando CID...</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mb-0">
                                                <label class="form-label fw-bold text-muted">Diagnóstico Atual:</label>
                                                <div class="p-4 bg-light rounded border" id="diagnostico-atual-display" style="min-height: 150px;">
                                                    <div class="text-center text-muted">
                                                        <i class="fas fa-clipboard-check fa-2x mb-3"></i>
                                                        <p class="mb-0">Carregando diagnóstico atual...</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Classificações Secundárias -->
                            <div class="row g-4 mb-4">
                                <div class="col-md-6">
                                    <div class="card border-secondary h-100">
                                        <div class="card-header bg-secondary text-white">
                                            <h6 class="mb-0"><i class="fas fa-list me-2"></i>CID Secundário</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="p-3 bg-light rounded border" id="cid-secundario-display" style="min-height: 100px;">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-list-ul fa-lg mb-2"></i>
                                                    <p>Nenhum CID secundário registrado</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-warning h-100">
                                        <div class="card-header bg-warning text-dark">
                                            <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Causas Associadas</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="p-3 bg-light rounded border" id="causas-associadas-display" style="min-height: 100px;">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-link fa-lg mb-2"></i>
                                                    <p>Nenhuma causa associada registrada</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Diagnosis editing form removed for read-only mode -->
                    </div>

                    <!-- Aba de Justificativas da Internação -->
                    <div class="tab-pane fade" id="justificativas-pane" role="tabpanel">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h6 class="mb-0 text-success fw-bold">Justificativas da Internação</h6>
                        </div>

                        <div id="justificativas-loading" class="text-center my-4" style="display:none;">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Carregando...</span>
                            </div>
                        </div>
                        
                        <div id="justificativas-visualizacao">
                            <!-- Cards com mais espaço -->
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="card border-danger h-100">
                                        <div class="card-header bg-danger text-white">
                                            <h6 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>Sinais e Sintomas</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="p-4 bg-light rounded border" id="sinais-sintomas-display" style="min-height: 200px;">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-heartbeat fa-2x mb-3"></i>
                                                    <p>Carregando sinais e sintomas...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-warning h-100">
                                        <div class="card-header bg-warning text-dark">
                                            <h6 class="mb-0"><i class="fas fa-clipboard-check me-2"></i>Condições Justificativas</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="p-4 bg-light rounded border" id="condicoes-display" style="min-height: 200px;">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-check-double fa-2x mb-3"></i>
                                                    <p>Carregando condições que justificam...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row g-4 mt-2">
                                <div class="col-12">
                                    <div class="card border-info">
                                        <div class="card-header bg-info text-white">
                                            <h6 class="mb-0"><i class="fas fa-flask me-2"></i>Principais Resultados Diagnósticos</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="p-4 bg-light rounded border" id="resultados-diagnosticos-display" style="min-height: 200px;">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-chart-line fa-2x mb-3"></i>
                                                    <p>Carregando resultados diagnósticos...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Formulário de Edição de Justificativas (oculto inicialmente) -->
                        <!-- Justifications editing form removed for read-only mode -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Evolução - REMOVED FOR READ-ONLY MODE -->

    <div id="enfermagemSection" class="content-section">
        <!-- Admissão de Enfermagem -->
        <div id="enfAdmissaoSection" class="enf-section card shadow-sm mb-4 active">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Admissão de Enfermagem</h5>
            </div>
            <div class="card-body">
                <div id="admissao-texto-container">
                    <div class="texto-admissao">
                        {% if internacao.admissao_enfermagem %}
                            {{ internacao.admissao_enfermagem | safe }}
                        {% else %}
                            <div class="text-muted">Nenhuma admissão de enfermagem registrada para este paciente.</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Evoluções de Enfermagem -->
        <div id="enfEvolucoesSection" class="enf-section card shadow-sm mb-4">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Evoluções de Enfermagem</h5>
            </div>
            <div class="card-body">
                <!-- Seletor de data para filtrar evoluções -->
                <div class="mb-3">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <label for="filtro-data" class="form-label">Filtrar por data:</label>
                            <div class="input-group">
                                <input type="date" id="filtro-data" class="form-control form-control-sm">
                                <button class="btn btn-sm btn-outline-primary" id="btn-filtrar-data">
                                    <i class="fas fa-filter"></i> Filtrar
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" id="btn-limpar-filtro">
                                    <i class="fas fa-times"></i> Limpar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3" id="hoje-container">
                    <h6 class="fw-bold text-success mb-2"><i class="fas fa-calendar-day me-1"></i> <span id="titulo-evolucoes-hoje">Evoluções de Hoje</span></h6>
                    <div class="table-responsive">
                        <table class="table table-striped table-medicamentos">
                            <thead class="table-info">
                                <tr>
                                    <th scope="col" style="width: 12%">Hora</th>
                                    <th scope="col" style="width: 13%">Enfermeiro</th>
                                    <th scope="col" style="width: 75%">Evolução</th>
                                </tr>
                            </thead>
                            <tbody id="listaEvolucoesDoDia">
                                <tr>
                                    <td colspan="3" class="text-center">Carregando evoluções de hoje...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="mb-3" id="antigas-container">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="fw-bold text-secondary mb-0"><i class="fas fa-history me-1"></i> Evoluções Anteriores</h6>
                        <span class="badge bg-info" id="contador-evolucoes-antigas">0</span>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-medicamentos">
                            <thead class="table-secondary">
                                <tr>
                                    <th scope="col" style="width: 12%">Data/Hora</th>
                                    <th scope="col" style="width: 13%">Enfermeiro</th>
                                    <th scope="col" style="width: 75%">Evolução</th>
                                </tr>
                            </thead>
                            <tbody id="listaEvolucoesAntigas">
                                <tr>
                                    <td colspan="3" class="text-center">Carregando evoluções anteriores...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- SAE -->
        <div id="enfSAESection" class="enf-section card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Sistematização da Assistência de Enfermagem (SAE)</h5>
            </div>
            <div class="card-body">
                <div id="listaSAE">
                    <p class="text-center text-muted">Carregando dados da SAE...</p>
                </div>
                <div id="historicoSAE" style="display: none;">
                    <h6 class="mb-3 text-secondary"><i class="fas fa-history me-2"></i> Histórico de SAE</h6>
                    <div id="listaHistoricoSAE">
                        <p class="text-center text-muted">Carregando histórico...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="examesSection" class="content-section">
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">Exames Laboratoriais</h5>
            </div>
            <div class="card-body">
                <div id="examesLaboratoriaisTexto" class="texto-evolucao">
                    {{ internacao.exames_laboratoriais or 'Não registrado.' }}
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Exames - REMOVED FOR READ-ONLY MODE -->

    <div id="receituarioSection" class="content-section">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Receituário</h5>
            </div>
            <div class="card-body">
                <div class="mb-3" id="hoje-container-receituario">
                    <h6 class="fw-bold text-success mb-2">
                        <i class="fas fa-calendar-day me-1"></i> 
                        <span id="titulo-receitas-hoje">Receitas de Hoje</span>
                    </h6>
                    <div id="listaReceitasDoDia">
                        <!-- Preenchido via JavaScript -->
                    </div>
                </div>
                
                <div class="mb-3" id="antigas-container-receituario">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="fw-bold text-secondary mb-0">
                            <i class="fas fa-history me-1"></i> Receitas Anteriores
                        </h6>
                        <span class="badge bg-info" id="contador-receitas-antigas">0</span>
                    </div>
                    <div id="listaReceitasAntigas">
                        <!-- Preenchido via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Receita - REMOVED FOR READ-ONLY MODE -->

    <div id="fichaReferenciaSection" class="content-section">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-file-export me-2"></i>Fichas de Referência
                </h5>
            </div>
            <div class="card-body">
                <div id="listaFichasReferencia">
                    <div class="text-center py-4">
                        <i class="fas fa-spinner fa-spin text-primary"></i> 
                        Carregando fichas de referência...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Área Multiprofissional -->
    <div id="areaMultiprofissionalSection" class="content-section">
        <!-- Fisioterapia -->
        <div id="fisioterapiaSection" class="mp-section card shadow-sm mb-4 active">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-running me-2"></i>Fisioterapia
                </h5>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-success btn-sm" onclick="abrirModalNovaEvolucaoFisioterapia()">
                        <i class="fas fa-plus me-1"></i>Nova Evolução
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="fisioterapia-container">
                    <div class="row">
                        <div class="col-12">
                            <h6 class="text-info mb-3">
                                <i class="fas fa-notes-medical me-2"></i>Evoluções de Fisioterapia
                            </h6>
                            <div class="mb-3" id="evolucoes-fisio-hoje-container">
                                <h6 class="fw-bold text-success mb-2">
                                    <i class="fas fa-calendar-day me-1"></i> 
                                    <span id="titulo-evolucoes-fisio-hoje">Evoluções de Hoje</span>
                                </h6>
                                <div class="table-responsive">
                                    <table class="table table-striped table-medicamentos">
                                        <thead class="table-info">
                                            <tr>
                                                <th scope="col" style="width: 12%">Hora</th>
                                                <th scope="col" style="width: 18%">Fisioterapeuta</th>
                                                <th scope="col" style="width: 70%">Evolução</th>
                                            </tr>
                                        </thead>
                                        <tbody id="listaEvolucoesFisioterapiaDoDia">
                                            <tr>
                                                <td colspan="3" class="text-center">Carregando evoluções de hoje...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="mb-3" id="evolucoes-fisio-antigas-container">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="fw-bold text-secondary mb-0">
                                        <i class="fas fa-history me-1"></i> Evoluções Anteriores
                                    </h6>
                                    <span class="badge bg-info" id="contador-evolucoes-fisio-antigas">0</span>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped table-medicamentos">
                                        <thead class="table-secondary">
                                            <tr>
                                                <th scope="col" style="width: 12%">Data/Hora</th>
                                                <th scope="col" style="width: 18%">Fisioterapeuta</th>
                                                <th scope="col" style="width: 70%">Evolução</th>
                                            </tr>
                                        </thead>
                                        <tbody id="listaEvolucoesFisioterapiaAntigas">
                                            <tr>
                                                <td colspan="3" class="text-center">Carregando evoluções anteriores...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Nutrição -->
        <div id="nutricaoSection" class="mp-section card shadow-sm mb-4">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-apple-alt me-2"></i>Nutrição
                </h5>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-warning btn-sm" onclick="abrirModalNovaEvolucaoNutricao()">
                        <i class="fas fa-plus me-1"></i>Nova Evolução
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="nutricao-container">
                    <div class="row">
                        <div class="col-12">
                            <h6 class="text-success mb-3">
                                <i class="fas fa-notes-medical me-2"></i>Evoluções Nutricionais
                            </h6>
                            <div class="mb-3" id="evolucoes-nutricao-hoje-container">
                                <h6 class="fw-bold text-success mb-2">
                                    <i class="fas fa-calendar-day me-1"></i> 
                                    <span id="titulo-evolucoes-nutricao-hoje">Evoluções de Hoje</span>
                                </h6>
                                <div class="table-responsive">
                                    <table class="table table-striped table-medicamentos">
                                        <thead class="table-success">
                                            <tr>
                                                <th scope="col" style="width: 12%">Hora</th>
                                                <th scope="col" style="width: 18%">Nutricionista</th>
                                                <th scope="col" style="width: 70%">Evolução</th>
                                            </tr>
                                        </thead>
                                        <tbody id="listaEvolucoesNutricaoDoDia">
                                            <tr>
                                                <td colspan="3" class="text-center">Carregando evoluções de hoje...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="mb-3" id="evolucoes-nutricao-antigas-container">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="fw-bold text-secondary mb-0">
                                        <i class="fas fa-history me-1"></i> Evoluções Anteriores
                                    </h6>
                                    <span class="badge bg-success" id="contador-evolucoes-nutricao-antigas">0</span>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped table-medicamentos">
                                        <thead class="table-secondary">
                                            <tr>
                                                <th scope="col" style="width: 12%">Data/Hora</th>
                                                <th scope="col" style="width: 18%">Nutricionista</th>
                                                <th scope="col" style="width: 70%">Evolução</th>
                                            </tr>
                                        </thead>
                                        <tbody id="listaEvolucoesNutricaoAntigas">
                                            <tr>
                                                <td colspan="3" class="text-center">Carregando evoluções anteriores...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Assistência Social -->
        <div id="assistenciaSocialSection" class="mp-section card shadow-sm mb-4">
            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-hands-helping me-2"></i>Assistência Social
                </h5>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-dark btn-sm" onclick="abrirModalNovaEvolucaoAssistenteSocial()">
                        <i class="fas fa-plus me-1"></i>Nova Evolução
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="assistencia-social-container">
                    <div class="row">
                        <div class="col-12">
                            <h6 class="text-warning mb-3">
                                <i class="fas fa-notes-medical me-2"></i>Evoluções de Assistência Social
                            </h6>
                            <div class="mb-3" id="evolucoes-assistente-social-hoje-container">
                                <h6 class="fw-bold text-warning mb-2">
                                    <i class="fas fa-calendar-day me-1"></i> 
                                    <span id="titulo-evolucoes-assistente-social-hoje">Evoluções de Hoje</span>
                                </h6>
                                <div class="table-responsive">
                                    <table class="table table-striped table-medicamentos">
                                        <thead class="table-warning">
                                            <tr>
                                                <th scope="col" style="width: 12%">Hora</th>
                                                <th scope="col" style="width: 18%">Assistente Social</th>
                                                <th scope="col" style="width: 70%">Evolução</th>
                                            </tr>
                                        </thead>
                                        <tbody id="listaEvolucoesAssistenteSocialDoDia">
                                            <tr>
                                                <td colspan="3" class="text-center">Carregando evoluções de hoje...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="mb-3" id="evolucoes-assistente-social-antigas-container">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="fw-bold text-secondary mb-0">
                                        <i class="fas fa-history me-1"></i> Evoluções Anteriores
                                    </h6>
                                    <span class="badge bg-warning" id="contador-evolucoes-assistente-social-antigas">0</span>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped table-medicamentos">
                                        <thead class="table-secondary">
                                            <tr>
                                                <th scope="col" style="width: 12%">Data/Hora</th>
                                                <th scope="col" style="width: 18%">Assistente Social</th>
                                                <th scope="col" style="width: 70%">Evolução</th>
                                            </tr>
                                        </thead>
                                        <tbody id="listaEvolucoesAssistenteSocialAntigas">
                                            <tr>
                                                <td colspan="3" class="text-center">Carregando evoluções anteriores...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="atestadoSection" class="content-section">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Atestados</h5>
            </div>
            <div class="card-body">
                <div class="mb-3" id="hoje-container-atestado">
                    <h6 class="fw-bold text-success mb-2">
                        <i class="fas fa-calendar-day me-1"></i> 
                        <span id="titulo-atestados-hoje">Atestados de Hoje</span>
                    </h6>
                    <div id="listaAtestadosDoDia">
                        <!-- Preenchido via JavaScript -->
                    </div>
                </div>
                
                <div class="mb-3" id="antigas-container-atestado">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="fw-bold text-secondary mb-0">
                            <i class="fas fa-history me-1"></i> Atestados Anteriores
                        </h6>
                        <span class="badge bg-info" id="contador-atestados-antigos">0</span>
                    </div>
                    <div id="listaAtestadosAntigos">
                        <!-- Preenchido via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Novo Atestado - REMOVED FOR READ-ONLY MODE -->

    <div id="imagensSection" class="content-section">
        <div class="alert alert-info">Visualização de imagens ainda não disponível.</div>
    </div>

    <!-- Seção de Informações de Internamento -->
    <div id="internamentoInfoSection" class="content-section">
        <div class="card shadow-sm">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">Informações Detalhadas do Internamento</h5>
            </div>
            <div class="card-body">
                <div id="internamento-info-loading" class="text-center my-3">
                    <div class="spinner-border text-warning" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                </div>
                <div id="internamento-info-content" style="display:none;"></div>
            </div>
            <div class="card-footer text-end" id="internamento-info-footer" style="display:none;">
                <!-- Botões de Salvar/Cancelar para o modo de edição aparecerão aqui -->
            </div>
        </div>
    </div>

</div>

<!-- jQuery (deve ser carregado primeiro) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- CSS Fix para modais -->
<link rel="stylesheet" href="/static/css/modal_fix.css">

<style>
/* Fix inline para garantir que o botão funcione */
#btn_salvar_ficha_referencia {
    position: relative !important;
    z-index: 1070 !important;
    pointer-events: auto !important;
    cursor: pointer !important;
    display: inline-block !important;
}

.modal-footer {
    position: relative !important;
    z-index: 1060 !important;
    pointer-events: auto !important;
}

#modalNovaFichaReferencia .modal-footer .btn {
    position: relative !important;
    z-index: 1065 !important;
    pointer-events: auto !important;
    cursor: pointer !important;
}
</style>


<!-- Definir variáveis globais importantes -->
<script>
    // Definir globalmente o ID do usuário e cargo para os scripts
    const session = {
        cargo: "{{ session.get('cargo', '') }}",
        user_id: "{{ session.get('user_id', '') }}"
    };
</script>

<!-- Campo oculto para o ID do atendimento -->
<input type="hidden" id="atendimento_id" value="{{ internacao.atendimento_id }}">

<script>
    // Variáveis globais
    let quill;
    let medicamentosAdicionados = [];
    
    // Extrair e validar o ID da internação - declaração local e global
    const internacaoId = parseInt("{{ internacao.id }}", 10);
    window.internacaoId = internacaoId; // Também disponibilizar globalmente
    console.log('ID da internação:', internacaoId);
    
    // Verificar se internacaoId é um número válido
    if (isNaN(internacaoId)) {
        console.error('Erro: ID da internação não é válido!');
        alert('Erro ao carregar o ID da internação. Por favor, recarregue a página ou contate o suporte.');
    }

    $(document).ready(function() {
        const urlAnterior = "{{ url_anterior }}";
        
        // Iniciar carregamento das visualizações de enfermagem
        carregarEvolucoesEnfermagem();
        carregarPrescricoesEnfermagem();
        
        // Configurar filtros
        $('#filtrarEvolucoesPorData').on('change', function() {
            const dataFiltro = $(this).val();
            filtrarEvolucoesEnfermagemPorData(dataFiltro);
        });
        
        $('#filtrarPrescricoesPorData').on('change', function() {
            const dataFiltro = $(this).val();
            filtrarPrescricoesEnfermagemPorData(dataFiltro);
        });
        
        // Debugar cargo do usuário
        console.log("Cargo do usuário na sessão:", "{{ session.get('cargo') }}");
        
        // Verificar permissão do usuário
        
        // Configurar navegação das abas
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('#menuTabs .nav-link').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    const target = this.getAttribute('data-target');
                    document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
                    if (target) document.getElementById(target).classList.add('active');
                });
            });

            // Ativar a primeira aba por padrão
            const primeiraAba = document.querySelector('#menuTabs .nav-link');
            if (primeiraAba) {
                primeiraAba.click();
            }
        });
        
        // Inicializar o Editor Quill
        try {
            console.log('A inicialização do editor Quill será feita pelo script clinica_medico.js');
            
            // Configurar observadores modernos após a inicialização (se necessário)
            setTimeout(() => {
                const editor = document.querySelector('#editor-container .ql-editor');
                if (editor) {
                    configurarObservadoresModernos(editor);
                }
            }, 100);
        } catch (error) {
            console.error('Erro ao configurar o editor Quill:', error);
            // Criar um fallback para o editor
            $('#editor-container').html('<textarea id="fallback-editor" class="form-control" rows="10" placeholder="Descreva a evolução do paciente..."></textarea>');
            
            // Atualizar o textarea oculto quando o fallback for alterado
            $('#fallback-editor').on('input', function() {
                $('#texto_evolucao').val($(this).val());
            });
        }

        // Carregar prescrições ao iniciar
        carregarPrescricoes();
        
        // Carregar evoluções ao iniciar
        carregarEvolucoes();
        
        // Inicializar módulo de receitas
        if (typeof inicializarModuloReceitas === 'function') {
            inicializarModuloReceitas();
        }
        
        // Adicionar evento para o botão de adicionar medicamento

        
        // Preparar modal HDA quando for aberto
        $('#modalEditarHDA').on('show.bs.modal', function() {
            // Pegar o valor atual do textarea escondido e colocar no campo de edição
            const hdaAtual = $('#hdaTexto').val();
            $('#textoHDA').val(hdaAtual);
        });
        
        // Função atualizarTabelaMedicamentos foi movida para clinica_medico.js
        
        // Adicionar listeners para eventos de carregamento de prescrições
        $(document).on('click', 'a.nav-link[href="#prescricaoSection"]', function() {
            console.log('Clique na aba de prescrições detectado');
            carregarPrescricoes();
        });

        $(document).on('click', '.fa-pills', function() {
            console.log('Clique no ícone de pílulas detectado');
            carregarPrescricoes();
        });

        // Carregar dados ao iniciar
        carregarPrescricoes();
        carregarEvolucoes();
        
        // Carregar evoluções de enfermagem
        carregarEvolucoesEnfermagem();
        
        // Carregar prescrições de enfermagem
        carregarPrescricoesEnfermagem();
        
        // Carregar evoluções de fisioterapia
        if (typeof carregarEvolucoesFisioterapia === 'function') {
            carregarEvolucoesFisioterapia();
        }
        
        // Configurar toggles para mostrar/ocultar evoluções e prescrições antigas
        $('#toggle-evolucoes-antigas').on('click', function() {
            const container = $('#antigas-container');
            const toggleText = $('#toggle-evolucoes-text');
            const toggleIcon = $(this).find('i');
            
            if (container.is(':visible')) {
                container.hide();
                toggleText.text('Mostrar Antigas');
                toggleIcon.removeClass('fa-eye-slash').addClass('fa-eye');
            } else {
                container.show();
                toggleText.text('Ocultar Antigas');
                toggleIcon.removeClass('fa-eye').addClass('fa-eye-slash');
            }
        });
        
        $('#toggle-prescricoes-antigas').on('click', function() {
            const container = $('#antigas-container-prescricao');
            if (container.is(':visible')) {
                container.hide();
                $('#toggle-prescricoes-text').text('Mostrar Antigas');
                $(this).find('i').removeClass('fa-eye-slash').addClass('fa-eye');
            } else {
                container.show();
                $('#toggle-prescricoes-text').text('Ocultar Antigas');
                $(this).find('i').removeClass('fa-eye').addClass('fa-eye-slash');
            }
        });
        
        // Carregar dados da SAE
        const pacienteId = parseInt("{{ paciente.id }}", 10);
        $.ajax({
            url: `/api/enfermagem/sae/${pacienteId}`,
            method: 'GET',
            success: function(response) {
                if (response.success && response.sae) {
                    const sae = response.sae;
                    
                    // Montar a visualização da SAE
                    let html = `
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div><strong>Data do Registro:</strong> ${new Date(sae.data_registro).toLocaleDateString('pt-BR')}</div>
                                    <div><span class="badge ${sae.eh_hoje ? 'bg-success' : 'bg-secondary'}">
                                        ${sae.eh_hoje ? 'Hoje' : 'Registro Anterior'}
                                    </span></div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <h6 class="text-primary mb-2">Sinais Vitais</h6>
                                        <div class="row g-2">
                                            <div class="col-md-2"><strong>PA:</strong> ${sae.pa}</div>
                                            <div class="col-md-2"><strong>FC:</strong> ${sae.fc}</div>
                                            <div class="col-md-2"><strong>SAT:</strong> ${sae.sat}</div>
                                            <div class="col-md-2"><strong>R:</strong> ${sae.r}</div>
                                            <div class="col-md-2"><strong>T:</strong> ${sae.t}</div>
                                            <div class="col-md-2"><strong>Pulso:</strong> ${sae.pulso}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <h6 class="text-primary mb-2">Hipótese Diagnóstica</h6>
                                        <div class="p-2 bg-light rounded">${sae.hipotese_diagnostica}</div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-primary mb-2">DX</h6>
                                        <div class="p-2 bg-light rounded">${sae.dx}</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <h6 class="text-primary mb-2">Medicação</h6>
                                        <div class="p-2 bg-light rounded">${sae.medicacao}</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <h6 class="text-primary mb-2">Alergias</h6>
                                        <div class="p-2 bg-light rounded">${sae.alergias}</div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-primary mb-2">Antecedentes Pessoais</h6>
                                        <div class="p-2 bg-light rounded">${sae.antecedentes_pessoais}</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <h6 class="text-primary mb-2">Diagnóstico de Enfermagem</h6>
                                        <div class="p-2 bg-light rounded">${sae.diagnostico_de_enfermagem}</div>
                                    </div>
                                </div>
                                
                                <div class="accordion" id="accordionSAE">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDetalhes">
                                                Ver mais detalhes da SAE
                                            </button>
                                        </h2>
                                        <div id="collapseDetalhes" class="accordion-collapse collapse">
                                            <div class="accordion-body">
                                                <div class="row mb-3">
                                                    <div class="col-md-6">
                                                        <h6 class="text-primary mb-2">Sistema Neurológico</h6>
                                                        <div class="p-2 bg-light rounded">${sae.sistema_neurologico}</div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <h6 class="text-primary mb-2">Estado Geral</h6>
                                                        <div class="p-2 bg-light rounded">${sae.estado_geral}</div>
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <div class="col-md-6">
                                                        <h6 class="text-primary mb-2">Ventilação</h6>
                                                        <div class="p-2 bg-light rounded">${sae.ventilacao}</div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <h6 class="text-primary mb-2">Pele</h6>
                                                        <div class="p-2 bg-light rounded">${sae.pele}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    $('#listaSAE').html(html);
                } else {
                    $('#listaSAE').html('<div class="alert alert-info">Nenhum registro SAE encontrado para este paciente.</div>');
                }
            },
            error: function(xhr, status, error) {
                console.error('Erro ao carregar SAE:', xhr.responseText);
                
                // Se o erro for de permissão (403), tentar buscar pelo histórico SAE
                if (xhr.status === 403) {
                    // Mostrar mensagem informativa
                    $('#listaSAE').html('<div class="alert alert-info">Acessando histórico de SAE...</div>');
                    
                    // Chamar diretamente a API de histórico SAE
                    const pacienteId = parseInt("{{ paciente.id }}", 10);
                    $.ajax({
                        url: `/api/enfermagem/sae/historico/${pacienteId}`,
                        method: 'GET',
                        success: function(response) {
                            if (response.success && response.sae && response.sae.length > 0) {
                                // Mostrar o primeiro registro como principal
                                const maisRecente = response.sae.sort((a, b) => new Date(b.data_registro) - new Date(a.data_registro))[0];
                                let htmlPrincipal = `
                                    <div class="card mb-3">
                                        <div class="card-header bg-light">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div><strong>Data do Registro:</strong> ${new Date(maisRecente.data_registro).toLocaleDateString('pt-BR')}</div>
                                                <div><span class="badge bg-secondary">Via Histórico SAE</span></div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <h6 class="text-primary mb-2">Sinais Vitais</h6>
                                                    <div class="row g-2">
                                                        <div class="col-md-2"><strong>PA:</strong> ${maisRecente.pa}</div>
                                                        <div class="col-md-2"><strong>FC:</strong> ${maisRecente.fc}</div>
                                                        <div class="col-md-2"><strong>SAT:</strong> ${maisRecente.sat}</div>
                                                        <div class="col-md-2"><strong>R:</strong> ${maisRecente.r}</div>
                                                        <div class="col-md-2"><strong>T:</strong> ${maisRecente.t}</div>
                                                        <div class="col-md-2"><strong>Pulso:</strong> ${maisRecente.pulso}</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <h6 class="text-primary mb-2">Hipótese Diagnóstica</h6>
                                                    <div class="p-2 bg-light rounded">${maisRecente.hipotese_diagnostica}</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6 class="text-primary mb-2">DX</h6>
                                                    <div class="p-2 bg-light rounded">${maisRecente.dx}</div>
                                                </div>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <h6 class="text-primary mb-2">Medicação</h6>
                                                    <div class="p-2 bg-light rounded">${maisRecente.medicacao}</div>
                                                </div>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <h6 class="text-primary mb-2">Alergias</h6>
                                                    <div class="p-2 bg-light rounded">${maisRecente.alergias}</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6 class="text-primary mb-2">Antecedentes Pessoais</h6>
                                                    <div class="p-2 bg-light rounded">${maisRecente.antecedentes_pessoais}</div>
                                                </div>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <h6 class="text-primary mb-2">Diagnóstico de Enfermagem</h6>
                                                    <div class="p-2 bg-light rounded">${maisRecente.diagnostico_de_enfermagem}</div>
                                                </div>
                                            </div>
                                            
                                            <div class="accordion" id="accordionSAE">
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDetalhes">
                                                            Ver mais detalhes da SAE
                                                        </button>
                                                    </h2>
                                                    <div id="collapseDetalhes" class="accordion-collapse collapse">
                                                        <div class="accordion-body">
                                                            <div class="row mb-3">
                                                                <div class="col-md-6">
                                                                    <h6 class="text-primary mb-2">Sistema Neurológico</h6>
                                                                    <div class="p-2 bg-light rounded">${maisRecente.sistema_neurologico}</div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <h6 class="text-primary mb-2">Estado Geral</h6>
                                                                    <div class="p-2 bg-light rounded">${maisRecente.estado_geral}</div>
                                                                </div>
                                                            </div>
                                                            <div class="row mb-3">
                                                                <div class="col-md-6">
                                                                    <h6 class="text-primary mb-2">Ventilação</h6>
                                                                    <div class="p-2 bg-light rounded">${maisRecente.ventilacao}</div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <h6 class="text-primary mb-2">Pele</h6>
                                                                    <div class="p-2 bg-light rounded">${maisRecente.pele}</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                
                                // Atualizar view principal
                                $('#listaSAE').html(htmlPrincipal);
                                
                                // Mostrar o histórico automaticamente
                                $('#historicoSAE').show();
                                $('#btn-historico-sae').html('<i class="fas fa-times"></i> Ocultar Histórico');
                                
                                // Carregar resto do histórico normalmente
                                carregarHistoricoSAE();
                            } else {
                                $('#listaSAE').html('<div class="alert alert-info">Nenhum registro SAE encontrado para este paciente.</div>');
                            }
                        },
                        error: function() {
                            $('#listaSAE').html('<div class="alert alert-info">Não foi possível acessar os dados de SAE.</div>');
                        }
                    });
                } else {
                    // Mostrar mensagem genérica para outros erros
                    $('#listaSAE').html('<div class="alert alert-info">Nenhum registro SAE disponível para este paciente.</div>');
                }
            }
        });

        // Adicionar funções para filtrar evoluções e prescrições por data
        
        // Configurar filtros
        $('#btn-filtrar-data').on('click', function() {
            const dataFiltro = $('#filtro-data').val();
            filtrarEvolucoesEnfermagemPorData(dataFiltro);
        });
        
        $('#btn-limpar-filtro').on('click', function() {
            $('#filtro-data').val('');
            carregarEvolucoesEnfermagem();
        });
        
        $('#btn-filtrar-data-prescricao').on('click', function() {
            const dataFiltro = $('#filtro-data-prescricao').val();
            filtrarPrescricoesEnfermagemPorData(dataFiltro);
        });
        
        $('#btn-limpar-filtro-prescricao').on('click', function() {
            $('#filtro-data-prescricao').val('');
            carregarPrescricoesEnfermagem();
        });
        
        // Configurar toggles para mostrar/ocultar evoluções e prescrições antigas
        $('#toggle-evolucoes-antigas').on('click', function() {
            const container = $('#antigas-container');
            const toggleText = $('#toggle-evolucoes-text');
            const toggleIcon = $(this).find('i');
            
            if (container.is(':visible')) {
                container.hide();
                toggleText.text('Mostrar Antigas');
                toggleIcon.removeClass('fa-eye-slash').addClass('fa-eye');
            } else {
                container.show();
                toggleText.text('Ocultar Antigas');
                toggleIcon.removeClass('fa-eye').addClass('fa-eye-slash');
            }
        });
        
        $('#toggle-prescricoes-antigas').on('click', function() {
            const container = $('#antigas-container-prescricao');
            if (container.is(':visible')) {
                container.hide();
                $('#toggle-prescricoes-text').text('Mostrar Antigas');
                $(this).find('i').removeClass('fa-eye-slash').addClass('fa-eye');
            } else {
                container.show();
                $('#toggle-prescricoes-text').text('Ocultar Antigas');
                $(this).find('i').removeClass('fa-eye').addClass('fa-eye-slash');
            }
        });
        
        // Configurar botão para mostrar histórico SAE
        $('#btn-historico-sae').on('click', function() {
            const historicoContainer = $('#historicoSAE');
            if (historicoContainer.is(':visible')) {
                historicoContainer.hide();
                $(this).html('<i class="fas fa-history"></i> Ver Histórico');
            } else {
                carregarHistoricoSAE();
                historicoContainer.show();
                $(this).html('<i class="fas fa-times"></i> Ocultar Histórico');
            }
        });

        // Ativar seção Enfermagem ao clicar no submenu
        $('.submenu .nav-link').on('click', function(){
            $('a.nav-link[href="#enfermagemSection"]').click();
        });

        // Inicializar visibilidade das seções de enfermagem
        $('.enf-section').removeClass('active').hide();
        $('#enfAdmissaoSection').addClass('active').show();

        // Clique no submenu para alternar seções
        $('.submenu-link').on('click', function(e){
            e.preventDefault();
            const alvo = $(this).data('enf-target');

            // Atualizar links ativos
            $('.submenu .nav-link').removeClass('active');
            $(this).addClass('active');

            // Mostrar seção correspondente
            $('.enf-section').removeClass('active').hide();
            $('#' + alvo).addClass('active').show();

            // Garantir que aba Enfermagem esteja ativada
            $('a.nav-link[href="#enfermagemSection"]').addClass('active');
        });

        // === ÁREA MULTIPROFISSIONAL ===
        
        // Ativar seção Multiprofissional ao clicar no submenu
        $('.submenu .nav-link[data-mp-target]').on('click', function(){
            $('a.nav-link[href="#areaMultiprofissionalSection"]').click();
        });

        // Inicializar visibilidade das seções multiprofissionais
        $('.mp-section').removeClass('active').hide();
        $('#fisioterapiaSection').addClass('active').show();

        // Clique no submenu multiprofissional para alternar seções
        $('[data-mp-target]').on('click', function(e){
            e.preventDefault();
            const alvo = $(this).data('mp-target');

            // Atualizar links ativos do submenu multiprofissional
            $('[data-mp-target]').removeClass('active');
            $(this).addClass('active');

            // Mostrar seção correspondente
            $('.mp-section').removeClass('active').hide();
            $('#' + alvo).addClass('active').show();

            // Garantir que aba Área Multiprofissional esteja ativada
            $('a.nav-link[href="#areaMultiprofissionalSection"]').addClass('active');
        });

        // Evento para abrir o modal de histórico de internamentos
        $('#btnHistoricoInternamentos').on('click', function() {
            $('#modalHistoricoInternamentos').modal('show');
            carregarHistoricoInternamentos();
        });
        
        // Eventos dos botões de debug
        $('#btn-show-debug').on('click', function() {
            $('#debug-panel').show();
            atualizarInformacoesDebug();
        });
        
        $('#btn-toggle-debug').on('click', function() {
            $('#debug-panel').hide();
        });
        
        $('#btn-debug-reload').on('click', function() {
            carregarHistoricoInternamentos();
        });
    });
    
    // Todas as funções foram movidas para o arquivo clinica_medico.js
    
    // Handler personalizado para modal HDA - Correção do erro de backdrop
    $(document).ready(function() {
        // Remover handlers conflitantes
        $('#modalEditarHDA').off('show.bs.modal shown.bs.modal');
        
        // Handler personalizado para o botão editar HDA
        $(document).on('click', '[data-bs-target="#modalEditarHDA"]', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            try {
                // Pegar valor atual do HDA
                const hdaAtual = $('#hdaTexto').val() || '';
                $('#textoHDA').val(hdaAtual);
                
                // Verificar se o modal existe
                const modalElement = document.getElementById('modalEditarHDA');
                if (!modalElement) {
                    console.error('Modal HDA não encontrado');
                    return false;
                }
                
                // Tentar abrir com Bootstrap 5
                if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
                    // Remover instância existente se houver
                    const existingInstance = bootstrap.Modal.getInstance(modalElement);
                    if (existingInstance) {
                        existingInstance.dispose();
                    }
                    
                    // Criar nova instância
                    const modal = new bootstrap.Modal(modalElement, {
                        backdrop: 'static',
                        keyboard: true,
                        focus: true
                    });
                    
                    modal.show();
                    
                } else {
                    // Fallback para jQuery
                    $('#modalEditarHDA').modal('show');
                }
                
            } catch (error) {
                console.error('Erro ao abrir modal HDA:', error);
                // Último recurso - mostrar modal manualmente
                $('#modalEditarHDA')
                    .removeClass('fade')
                    .addClass('show')
                    .css({
                        'display': 'block',
                        'padding-right': '17px'
                    });
                
                $('body').addClass('modal-open');
                
                // Adicionar backdrop
                if ($('.modal-backdrop').length === 0) {
                    $('body').append('<div class="modal-backdrop fade show"></div>');
                }
            }
            
            return false;
        });
    });
</script>
<!-- Modal Nova Prescrição - REMOVED FOR READ-ONLY MODE -->


<!-- JavaScript functions for editing/adding functionality removed for read-only mode -->
<script>
    // Read-only mode - editing functions have been removed
</script>
 
<!-- Editing-related JavaScript functions removed for read-only mode -->
<script>
    // Read-only mode - only keeping essential viewing functions
    
    // Function to load patient history (viewing only)
    function carregarHistoricoInternamentos() {
        let pacienteId = $('#paciente_id').val();
        
        if (!pacienteId) {
            pacienteId = "{{ paciente.id }}";
        }
        
        if (!pacienteId) {
            console.error('ID do paciente não encontrado');
            $('#loading-historico').hide();
            $('#conteudo-historico').show();
            $('#sem-historico').show().html(`
                <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                <h5 class="text-warning">Erro de configuração</h5>
                <p class="text-muted">ID do paciente não encontrado. Verifique a configuração da página.</p>
            `);
            return;
        }
        
        const atendimentoAtual = $('#atendimento_id').val() || "{{ internacao.atendimento_id }}";
        
        atualizarInformacoesDebug();
        
        $('#loading-historico').show();
        $('#conteudo-historico').hide();
        
        console.log('Carregando histórico de internamentos:');
        console.log('- Paciente ID:', pacienteId);
        console.log('- Atendimento atual:', atendimentoAtual);
        console.log('- URL da API:', `/api/paciente/${pacienteId}/historico-internamentos`);
        
        $.ajax({
            url: `/api/paciente/${pacienteId}/historico-internamentos`,
            method: 'GET',
            data: {
                atendimento_atual: atendimentoAtual
            },
            success: function(response) {
                console.log('Resposta da API:', response);
                
                if (response.success && response.internamentos && response.internamentos.length > 0) {
                    renderizarHistoricoInternamentos(response.internamentos);
                    $('#sem-historico').hide();
                } else {
                    console.log('Nenhum internamento encontrado no histórico');
                    $('#sem-historico').show();
                }
                
                $('#loading-historico').hide();
                $('#conteudo-historico').show();
            },
            error: function(xhr, status, error) {
                console.error('Erro detalhado na requisição AJAX:');
                console.error('- Status:', xhr.status);
                console.error('- Status Text:', xhr.statusText);
                console.error('- Response Text:', xhr.responseText);
                console.error('- Error:', error);
                
                let mensagemErro = 'Erro desconhecido';
                
                try {
                    const responseJson = JSON.parse(xhr.responseText);
                    mensagemErro = responseJson.message || mensagemErro;
                } catch (e) {
                    if (xhr.status === 404) {
                        mensagemErro = 'Endpoint não encontrado';
                    } else if (xhr.status === 403) {
                        mensagemErro = 'Acesso negado';
                    } else if (xhr.status === 500) {
                        mensagemErro = 'Erro interno do servidor';
                    }
                }
                
                $('#loading-historico').hide();
                $('#conteudo-historico').show();
                $('#sem-historico').show();
                
                $('#debug-panel').show();
                atualizarInformacoesDebug();
                
                $('#sem-historico').html(`
                    <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                    <h5 class="text-warning">Erro ao carregar histórico</h5>
                    <p class="text-muted">${mensagemErro}</p>
                    <small class="text-muted">Código do erro: ${xhr.status}</small>
                `);
            }
        });
    }
    
    // Function to render patient history table (viewing only)
    function renderizarHistoricoInternamentos(internamentos) {
        let html = '';
        
        internamentos.forEach(function(internamento) {
            const dataInternacao = internamento.data_internacao ? 
                new Date(internamento.data_internacao).toLocaleDateString('pt-BR') : 
                'Não informada';
                
            const dataAlta = internamento.data_alta ? 
                new Date(internamento.data_alta).toLocaleDateString('pt-BR') : 
                '<span class="badge bg-warning">Em andamento</span>';
                
            const diagnostico = internamento.diagnostico_inicial || internamento.diagnostico || 'Não informado';
            const medico = internamento.medico_nome || 'Não informado';
            const leito = internamento.leito || 'Não informado';
            
            const diagnosticoTruncado = diagnostico.length > 80 ? 
                diagnostico.substring(0, 80) + '...' : 
                diagnostico;
            
            html += `
                <tr>
                    <td>
                        <strong>${dataInternacao}</strong>
                    </td>
                    <td>
                        <span class="text-truncate" title="${diagnostico}">
                            ${diagnosticoTruncado}
                        </span>
                    </td>
                    <td>${dataAlta}</td>
                    <td>
                        <small class="text-muted">Dr(a).</small><br>
                        ${medico}
                    </td>
                    <td>
                        <span class="badge bg-light text-dark">${leito}</span>
                    </td>
                    <td>
                        <button type="button" class="btn btn-sm btn-outline-primary" 
                                onclick="visualizarInternamentoHistorico('${internamento.atendimento_id}')"
                                title="Ver detalhes do internamento">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `;
        });
        
        $('#tabelaHistoricoInternamentos').html(html);
    }
    
    // Function to view historical hospitalization (viewing only)
    function visualizarInternamentoHistorico(atendimentoId) {
        const url = `/clinica/historico-internacao/${atendimentoId}`;
        window.open(url, '_blank');
    }
    
    // Function to update debug information
    function atualizarInformacoesDebug() {
        const pacienteId = $('#paciente_id').val() || "{{ paciente.id }}";
        const atendimentoId = $('#atendimento_id').val() || "{{ internacao.atendimento_id }}";
        const urlApi = `/api/paciente/${pacienteId}/historico-internamentos`;
        
        $('#debug-paciente-id').text(pacienteId || 'Não encontrado');
        $('#debug-atendimento-id').text(atendimentoId || 'Não encontrado');
        $('#debug-url-api').text(urlApi);
    }
    
    // Ready function for read-only mode
    $(document).ready(function() {
        console.log('Read-only mode initialized');
    });
</script>

<!-- Modal de Informações de Internamento - REMOVED FOR READ-ONLY MODE -->

<!-- Modal Histórico de Internamentos -->
<div class="modal fade" id="modalHistoricoInternamentos" tabindex="-1" aria-labelledby="modalHistoricoInternamentosLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="modalHistoricoInternamentosLabel">
                    <i class="fas fa-history me-2"></i>Histórico de Internamentos - {{ paciente.nome }}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <div id="loading-historico" class="text-center my-4">
                    <div class="spinner-border text-info" role="status">
                        <span class="visually-hidden">Carregando histórico...</span>
                    </div>
                    <p class="mt-2 text-muted">Buscando internamentos anteriores...</p>
                </div>
                
                <!-- Painel de Debug -->
                <div class="alert alert-light border mb-3" id="debug-panel" style="display: none;">
                    <h6 class="alert-heading"><i class="fas fa-bug me-1"></i>Informações de Debug</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <small><strong>ID do Paciente:</strong></small>
                            <div id="debug-paciente-id" class="font-monospace">-</div>
                        </div>
                        <div class="col-md-6">
                            <small><strong>ID do Atendimento:</strong></small>
                            <div id="debug-atendimento-id" class="font-monospace">-</div>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small><strong>URL da API:</strong></small>
                        <div id="debug-url-api" class="font-monospace text-break">-</div>
                    </div>
                    <div class="mt-2">
                        <button type="button" class="btn btn-sm btn-outline-primary" id="btn-debug-reload">
                            <i class="fas fa-redo me-1"></i>Tentar Novamente
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" id="btn-toggle-debug">
                            <i class="fas fa-eye-slash me-1"></i>Ocultar Debug
                        </button>
                    </div>
                </div>
                
                <div id="conteudo-historico" style="display: none;">
                    <div class="alert alert-info mb-3">
                        <i class="fas fa-info-circle me-2"></i>
                        Este histórico inclui todas as internações anteriores do paciente no sistema.
                        <button type="button" class="btn btn-sm btn-outline-info float-end" id="btn-show-debug">
                            <i class="fas fa-bug me-1"></i>Debug
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-info">
                                <tr>
                                    <th><i class="fas fa-calendar-alt me-1"></i>Data Internação</th>
                                    <th><i class="fas fa-stethoscope me-1"></i>Diagnóstico</th>
                                    <th><i class="fas fa-calendar-check me-1"></i>Data Alta</th>
                                    <th><i class="fas fa-user-md me-1"></i>Médico</th>
                                    <th><i class="fas fa-bed me-1"></i>Leito</th>
                                    <th><i class="fas fa-eye me-1"></i>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaHistoricoInternamentos">
                                <!-- Preenchido via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="sem-historico" class="text-center py-4" style="display: none;">
                        <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Nenhum internamento anterior encontrado</h5>
                        <p class="text-muted">Este é o primeiro internamento registrado para este paciente.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Informações de Alta -->
<div class="modal fade" id="modalInformacoesAlta" tabindex="-1" aria-labelledby="modalInformacoesAltaLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="modalInformacoesAltaLabel">
                    <i class="fas fa-user-check me-2"></i>Informações de Alta do Paciente
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-4">
                    <div class="col-md-8">
                        <h6 class="text-primary mb-2">
                            <i class="fas fa-user me-2"></i>Dados do Paciente
                        </h6>
                        <div class="d-flex gap-4">
                            <strong>Nome:</strong> <span id="altaNomePaciente"></span>
                            <strong>CPF:</strong> <span id="altaCpfPaciente"></span>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <h6 class="text-success mb-2">
                            <i class="fas fa-calendar-check me-2"></i>Data de Alta
                        </h6>
                        <strong id="altaDataAlta" class="text-success fs-5"></strong>
                    </div>
                </div>

                <div class="row g-4">
                    <div class="col-lg-12">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-light border-0">
                                <h6 class="mb-0 text-primary">
                                    <i class="fas fa-stethoscope me-2"></i>Diagnóstico Final
                                </h6>
                            </div>
                            <div class="card-body">
                                <p id="altaDiagnosticoAlta" class="mb-0 text-justify" style="min-height: 60px; white-space: pre-wrap;"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-12">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-light border-0">
                                <h6 class="mb-0 text-primary">
                                    <i class="fas fa-history me-2"></i>Histórico da Internação
                                </h6>
                            </div>
                            <div class="card-body">
                                <p id="altaHistoricoInternacao" class="mb-0 text-justify" style="min-height: 100px; white-space: pre-wrap;"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-light border-0">
                                <h6 class="mb-0 text-primary">
                                    <i class="fas fa-heart me-2"></i>Cuidados Gerais
                                </h6>
                            </div>
                            <div class="card-body">
                                <p id="altaCuidadosGerais" class="mb-0 text-justify" style="min-height: 60px; white-space: pre-wrap;"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
                <button type="button" class="btn btn-primary" onclick="imprimirInformacoesAlta()">
                    <i class="fas fa-print me-2"></i>Imprimir
                </button>
            </div>
        </div>
    </div>
</div>

    <!-- Modal para Nova Ficha de Referência - REMOVED FOR READ-ONLY MODE -->

    <!-- Modal para Visualizar Ficha de Referência -->
    <div class="modal fade" id="modalVisualizarFichaReferencia" tabindex="-1" aria-labelledby="modalVisualizarFichaReferenciaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalVisualizarFichaReferenciaLabel">
                        <i class="fas fa-eye me-2"></i>Visualizar Ficha de Referência
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <!-- Conteúdo será inserido dinamicamente pelo JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nova Evolução de Fisioterapia -->
    <div class="modal fade" id="modalNovaEvolucaoFisioterapia" tabindex="-1" aria-labelledby="modalNovaEvolucaoFisioterapiaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalNovaEvolucaoFisioterapiaLabel">
                        <i class="fas fa-running me-2"></i>Nova Evolução de Fisioterapia
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="formNovaEvolucaoFisioterapia">
                        <!-- Campos hidden para dados automáticos -->
                        <input type="hidden" id="fisioterapeutaHidden" value="">
                        <input type="hidden" id="dataEvolucaoFisio" value="">
                        <input type="hidden" id="horaEvolucaoFisio" value="">
                        
                        <div class="mb-3">
                            <label for="textoEvolucaoFisio" class="form-label">Evolução de Fisioterapia</label>
                            <textarea class="form-control" id="textoEvolucaoFisio" rows="8" 
                                    placeholder="Descreva a evolução do paciente na fisioterapia..." required></textarea>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Nota:</strong> O registro será salvo automaticamente com a data/hora atual e o profissional logado.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-success" onclick="salvarNovaEvolucaoFisioterapia()">
                        <i class="fas fa-save me-1"></i>Salvar Evolução
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nova Evolução de Nutrição -->
    <div class="modal fade" id="modalNovaEvolucaoNutricao" tabindex="-1" aria-labelledby="modalNovaEvolucaoNutricaoLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="modalNovaEvolucaoNutricaoLabel">
                        <i class="fas fa-apple-alt me-2"></i>Nova Evolução Nutricional
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="formNovaEvolucaoNutricao">
                        <!-- Campos hidden para dados automáticos -->
                        <input type="hidden" id="nutricionistaHidden" value="">
                        <input type="hidden" id="dataEvolucaoNutricao" value="">
                        <input type="hidden" id="horaEvolucaoNutricao" value="">
                        
                        <div class="mb-3">
                            <label for="textoEvolucaoNutricao" class="form-label">Evolução Nutricional</label>
                            <textarea class="form-control" id="textoEvolucaoNutricao" rows="8" 
                                    placeholder="Descreva a evolução nutricional do paciente..." required></textarea>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Nota:</strong> O registro será salvo automaticamente com a data/hora atual e o profissional logado.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-success" onclick="salvarNovaEvolucaoNutricao()">
                        <i class="fas fa-save me-1"></i>Salvar Evolução
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Evolução Assistência Social -->
    <div class="modal fade" id="modalNovaEvolucaoAssistenteSocial" tabindex="-1" aria-labelledby="modalNovaEvolucaoAssistenteSocialLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="modalNovaEvolucaoAssistenteSocialLabel">
                        <i class="fas fa-hands-helping me-2"></i>Nova Evolução de Assistência Social
                    </h5>
                    <button type="button" class="btn-close btn-close-dark" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="formNovaEvolucaoAssistenteSocial">
                        <!-- Campos hidden para dados automáticos -->
                        <input type="hidden" id="assistenteSocialHidden" value="">
                        <input type="hidden" id="dataEvolucaoAssistenteSocial" value="">
                        <input type="hidden" id="horaEvolucaoAssistenteSocial" value="">
                        
                        <div class="mb-3">
                            <label for="textoEvolucaoAssistenteSocial" class="form-label">Evolução de Assistência Social</label>
                            <textarea class="form-control" id="textoEvolucaoAssistenteSocial" rows="8" 
                                    placeholder="Descreva a evolução de assistência social do paciente..." required></textarea>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Nota:</strong> O registro será salvo automaticamente com a data/hora atual e o profissional logado.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-warning" onclick="salvarNovaEvolucaoAssistenteSocial()">
                        <i class="fas fa-save me-1"></i>Salvar Evolução
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>